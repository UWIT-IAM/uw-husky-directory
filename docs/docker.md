# Docker Overview

We use docker to track, test, and deploy our builds. 

## Tagging Strategy

Images tagged with `commit-X` (where `X` is the first 10 characters of a commit hash)
refer to a development build against a specific git commit.

These build images, when attached to a pull request, will also be tagged with 
`pull-request-X`, where `X` is the PR number assigned by github. This will always 
reflect the latest build of the pull request; previous builds will still be 
accessible by their commit tag above.

Images tagged with `deploy-dev.X` (where X is an autogenerated, sortable timestamp and version number) 

are images that were tagged for deployment 
to our [development environment](https://github.com/uwit-iam/gcp-k8/tree/master/dev/uw-directory).

Images tagged with a `deploy-eval.X` will be 
automatically deployed to our eval environment. 

Prod is the same, but `deploy-prod.X`

## Image Retention

This is a problem that still needs solving. See IAM-258.

## Google Artifact Registry (GAR) Repository

The repository for this service is `us-docker.pkg.dev/uwit-mci-iam/containers/husky-directory`.
Access to this repository requires operator permissions on our Google Cloud project. Team members can reach out on Teams for access if they do not have it already.
For GitHub Actions authentication setup and configuration,
please refer to our `action-auth-artifact-registry` [documentation](https://github.com/UWIT-IAM/action-auth-artifact-registry).


## Running images

See [Running the app](running-the-app.md).

[development-server]: https://github.com/uwit-iam/uw-husky-directory/tree/main/docker/development-server.dockerfile 
[poetry-base]: https://github.com/UWIT-IAM/action-setup-poetry-project
[search-image-tags]: https://github.com/uwit-iam/uw-husky-directory/tree/main/scripts/search-image-tags.sh]
[commits]: commits.md
[Goole Artifact Registry (GAR)]: https://console.cloud.google.com/artifacts/docker/uwit-mci-iam/us/containers/husky-directory
[github repository secrets]: https://github.com/UWIT-IAM/uw-husky-directory/settings/secrets/actions
